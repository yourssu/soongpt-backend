# 전필/전기/전선 학과+학년 조회 검증 실행 계획 (API: api.dev.soongpt.yourssu.com)

## 1) 목적
- `전필/전기/전선` 과목이 **학과 + 학년 조합** 기준으로 API 조회 시 올바르게 노출되는지 검증
- 기존 DB 반영(`course`, `target`) 상태가 실제 조회 API 결과와 일치하는지 확인

---

## 2) 검증 범위
- 환경: `https://api.dev.soongpt.yourssu.com`
- 분류: `전필`, `전기`, `전선`
- 조합: 학과(major_department) × 학년(1~5)
- 학생유형: 일반학생(student_type=GENERAL) 기준

> 참고: 교양/채플/기타는 본 검증 범위에서 제외

---

## 3) 사전 준비
1. **API 스펙 확인**
   - 조회 endpoint path
   - query/body 파라미터 (학과 id/name, 학년, 카테고리)
   - 인증 방식(Bearer token/쿠키 등)
2. **검증 기준 데이터 준비**
   - DB 기대결과 생성 SQL 준비
   - 카테고리 매핑 고정:
     - 전필 → `MAJOR_REQUIRED`
     - 전기 → `MAJOR_BASIC`
     - 전선 → `MAJOR_ELECTIVE`
3. **학과 매핑 테이블 고정**
   - department.id ↔ department.name
   - 검증 리포트에 id/name 모두 기록

---

## 4) 검증 방법

### 4-1. 기준(정답) 데이터 산출
- 조합별 기대결과를 DB에서 산출:
  - 입력: (department_id, grade, category)
  - 조건:
    - `course.category` = 매핑 카테고리
    - `target.student_type=0`(GENERAL)
    - allow 존재 (`is_denied=0`) + deny 미해당 (`is_denied=1` 제외)
    - scope match (UNIVERSITY/COLLEGE/DEPARTMENT)

### 4-2. API 결과 수집
- 동일 입력 조합으로 curl 요청 실행
- 응답에서 과목코드 목록 추출/정규화(중복 제거, 정렬)

### 4-3. 자동 대조
- 조합별로 `expected(DB)` vs `actual(API)` 비교
- 결과 분류:
  - PASS: 완전 일치
  - MISSING_IN_API: DB 기대에 있으나 API 미노출
  - EXTRA_IN_API: API 노출이나 DB 기대에 없음

---

## 5) 실행 단계

### Phase A. 스모크 테스트
- 대표 학과 5개 × 학년 2개(1,3) × 카테고리 3개
- 총 30케이스로 endpoint/파라미터/응답 형식 먼저 안정화

### Phase B. 전체 전수 테스트
- 전체 학과 × 학년(1~5) × 카테고리(전필/전기/전선)
- 조합별 결과를 CSV로 저장

### Phase C. 의심 케이스 재검증
- 불일치 조합 재호출(2회 이상)
- 캐시/타이밍 이슈 배제
- 필요 시 raw target 문자열/특수 정책(예: n학년 제외) 별도 태깅

---

## 6) 산출물
1. 실행 스크립트(또는 curl 배치 스크립트)
2. 조합별 결과 CSV
   - columns: department_id, department_name, grade, category, expected_count, actual_count, missing_codes, extra_codes, status
3. 최종 보고서
   - 전체 PASS율
   - 카테고리별/학과별 실패 현황
   - 원인 후보 및 수정 제안(SQL/API)

---

## 7) 판정 기준
- 전체 조합 기준 **PASS 100%** 목표
- 불일치 1건 이상이면 원인 분석 후 재검증 라운드 진행

---

## 8) 리스크 및 대응
- 리스크: API 응답 페이징/정렬/중복 포맷 차이
  - 대응: 과목코드 기준으로만 비교
- 리스크: 인증/권한별 결과 차이
  - 대응: 단일 검증 계정/권한 고정
- 리스크: 캐시 반영 지연
  - 대응: 재시도 + 간격 두고 재검증

---

## 9) 바로 실행용 체크리스트
- [ ] endpoint/파라미터/인증 최종 확정
- [ ] 스모크 30케이스 PASS
- [ ] 전체 조합 실행
- [ ] mismatch 목록 추출
- [ ] 재검증 후 최종 보고서 확정
