# 수강대상 파싱 검증 가이드라인

## 개요
이 문서는 `transform_targets.py`로 파싱된 수강대상 데이터를 검증하기 위한 기준을 정의합니다.

## 신뢰도 분류 기준

### 🔴 Low Confidence (낮음)
파싱 결과를 신뢰할 수 없으며, 반드시 수정이 필요한 경우:
- 원본 텍스트의 일부가 파싱되지 않음 (unmapped tokens 존재)
- 파싱이 전혀 이루어지지 않음 (융합전공 등)
- 제외 대상만 있고 허용 기준이 없는 경우

### 🟡 Medium Confidence (보통)
파싱은 되었으나 검토가 필요한 경우:
- 복잡한 원본이 단순하게 파싱됨 (정보 손실 가능성)
- UNIVERSITY 스코프인데 "전체" 표현이 명시되지 않음
- 엄격한 제한(strict restriction)인데 구체적인 학과가 없음
- 여러 학과가 한 번에 파싱됨 (4개 이상)

### 🟢 High Confidence (높음)
파싱 결과가 정확하고 신뢰할 수 있는 경우:
- 모든 토큰이 매핑됨
- 스코프가 명확함
- 제외/포함 로직이 올바름

---

## 이슈 타입별 검증 방법

### ❌ unmapped_tokens (미매핑 토큰)
**문제**: 원본 텍스트의 일부가 파싱되지 않았습니다.

**확인 사항**:
1. 쉼표(`,`) 토큰이 unmapped에 포함되어 있다면 → **무시 가능** (구분자일 뿐)
2. 의미 있는 단어가 unmapped에 있다면 → **수정 필요**
   - 예: "교환학생", "계약학과", "융합전공" 등

**조치**:
- `DEPT_ALIAS`나 `COLLEGE_ALIAS`에 추가
- 특수 케이스로 처리 로직 추가
- 불필요한 키워드는 필터링 목록에 추가

**예시**:
```
원본: "1학년 컴퓨터 ,전자공학전공 ,IT융합전공"
Unmapped: [',', ',']
→ 쉼표는 무시 가능, 학과명은 정상 파싱됨 ✅

원본: "전체학년 교환학생(대상외수강제한)"
Unmapped: ['교환학생']
→ "교환학생"이 파싱 안됨, 처리 필요 ⚠️
```

---

### ⚠️ no_parsing (파싱 실패)
**문제**: 원본 텍스트가 전혀 파싱되지 않았습니다.

**확인 사항**:
1. 융합전공 이름인가? (예: "통일외교및개발협력융합")
2. data.yml에 정의되지 않은 학과/단과대인가?
3. 특수한 형식의 텍스트인가?

**조치**:
- data.yml에 학과/전공 추가
- 융합전공의 경우 별도 매핑 테이블 생성
- 특수 패턴은 전처리 로직 추가

**예시**:
```
원본: "전체학년 ICT유통물류융합"
파싱 결과: []
→ "ICT유통물류융합"을 data.yml에 추가하거나 융합전공 테이블 생성 필요
```

---

### 📚 multiple_departments (다중 학과)
**문제**: 하나의 입력에서 4개 이상의 학과가 파싱되었습니다.

**확인 사항**:
1. 실제로 여러 학과를 나열한 것인가?
   - 예: "1학년 불문, 중문, 일어일문, 철학, 사학" → **정상** ✅
2. 부분 매칭으로 인해 과도하게 매칭된 것인가?
   - 예: "건축" → "건축학전공", "실내건축전공", "건축공학전공" 모두 매칭 → **검토 필요** ⚠️

**조치**:
- 정상적인 나열이면 그대로 유지
- 과도한 매칭이면 DEPT_ALIAS 수정 또는 매칭 로직 개선

---

### 🎯 strict_without_specifics (애매한 제한)
**문제**: "대상외수강제한" 플래그가 있는데 UNIVERSITY 스코프만 있습니다.

**확인 사항**:
1. 원본에 구체적인 학과/단과대가 명시되어 있는가?
2. 정말로 전체 대상 제한인가?

**조치**:
- 원본에 학과가 있다면 파싱 로직 개선
- 정말로 전체 제한이면 그대로 유지

**예시**:
```
원본: "전체 (대상외수강제한)"
파싱: scopeType: UNIVERSITY, collegeName: null, departmentName: null, isStrictRestriction: true
→ 너무 광범위한 제한, 원본 확인 필요
```

---

### 🏫 ambiguous_university_scope (애매한 전체)
**문제**: "전체"가 명시되지 않았는데 UNIVERSITY 스코프로 파싱되었습니다.

**확인 사항**:
1. 파싱 로직이 잘못 추론한 것인가?
2. 실제로 전체를 의미하는가?

**조치**:
- 원본 텍스트와 비교해서 스코프 수정
- 파싱 로직 개선

---

### 📉 oversimplified (과단순화)
**문제**: 복잡한 원본 텍스트(20자 이상)가 단일 UNIVERSITY 스코프로 파싱되었습니다.

**확인 사항**:
1. 정보 손실이 있는가?
2. 특수 플래그(foreigner, military 등)만으로 충분한가?

**조치**:
- 원본을 다시 분석해서 누락된 정보 추가
- 특수 케이스면 그대로 유지

**예시**:
```
원본: "전체학년 ;순수외국인입학생 (대상외수강제한)"
파싱: scopeType: UNIVERSITY, isForeignerOnly: true, isExcluded: true
→ 특수 케이스, 정보 손실 없음 ✅
```

---

### 🚫 exclusion_without_base (기준 누락)
**문제**: 제외 대상만 있고 허용 기준이 없습니다.

**확인 사항**:
1. 원본에 "전체 (XXX 제외)" 패턴인가?
2. 파싱 로직이 기본 UNIVERSITY 타겟을 생성했는가?

**조치**:
- 제외 로직 개선 (기본 허용 타겟 자동 추가)
- 원본이 이상하면 데이터 소스 확인

**예시**:
```
원본: "전체학년 외국국적학생(2~3학년), 계약학과(정보보호학과 제외)"
파싱: isExcluded: true 타겟만 존재
→ "전체학년 (제외 대상 제외)" 형태로 기본 허용 타겟 추가 필요
```

---

## 검증 워크플로우

### 1단계: 자동 분석
```bash
python transform_targets.py
python analyze_results.py
python convert_for_flashcard.py
```

### 2단계: 수동 검토
1. `flashcard_review.html`을 브라우저에서 열기
2. `test/{timestamp}/suspicious_for_review.json` 파일 열기
3. Low confidence 항목부터 검토 시작

### 3단계: 오류 표시
- 문제가 확실한 항목: `E` 키로 오류 표시
- 애매한 항목: 메모하고 넘어가기

### 4단계: 결과 수집
- `U` 키로 오류 항목 리스트 확인
- JSON 복사해서 수정 작업 진행

---

## 수정 우선순위

### P0 (즉시 수정 필요)
- no_parsing (파싱 완전 실패)
- exclusion_without_base (제외만 있고 기준 없음)
- 의미 있는 unmapped_tokens (학과명, 전공명 등)

### P1 (검토 후 수정)
- strict_without_specifics
- ambiguous_university_scope
- oversimplified (정보 손실 확인 필요)

### P2 (개선 권장)
- multiple_departments (과도한 매칭)
- unmapped_tokens (쉼표 등 무해한 토큰)

---

## 체크리스트

각 항목 검토 시 다음을 확인:

- [ ] 원본 텍스트와 파싱 결과가 일치하는가?
- [ ] 모든 의미 있는 토큰이 파싱되었는가?
- [ ] 스코프 타입이 올바른가? (UNIVERSITY/COLLEGE/DEPARTMENT)
- [ ] 학년 범위가 올바른가?
- [ ] 제외/포함 플래그가 올바른가?
- [ ] 특수 플래그(외국인, 군위탁, 교직)가 올바른가?

---

## 참고 자료

### 파싱 로직 주요 파일
- `transform_targets.py`: 메인 파싱 스크립트
- `data.yml`: 단과대학 및 학과 정의
- `DEPT_ALIAS`, `COLLEGE_ALIAS`: 별칭 매핑

### 분석 도구
- `analyze_results.py`: 자동 분석 스크립트
- `generate_summary.py`: 리포트 생성
- `flashcard_review.html`: 수동 검토 도구
